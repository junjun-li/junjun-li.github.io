<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>观察者模式(前端用的最多) | 前端积累</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="种一棵树最好的时间是十年前，其次就是现在。">
    
    <link rel="preload" href="/assets/css/0.styles.158fcf67.css" as="style"><link rel="preload" href="/assets/js/app.a861c563.js" as="script"><link rel="preload" href="/assets/js/2.607a1425.js" as="script"><link rel="preload" href="/assets/js/111.85d639f5.js" as="script"><link rel="prefetch" href="/assets/js/10.38883a31.js"><link rel="prefetch" href="/assets/js/100.09faa561.js"><link rel="prefetch" href="/assets/js/101.6b7b3407.js"><link rel="prefetch" href="/assets/js/102.89111c6f.js"><link rel="prefetch" href="/assets/js/103.cfc05697.js"><link rel="prefetch" href="/assets/js/104.62d51557.js"><link rel="prefetch" href="/assets/js/105.e210c5f0.js"><link rel="prefetch" href="/assets/js/106.e225f628.js"><link rel="prefetch" href="/assets/js/107.66acfbd0.js"><link rel="prefetch" href="/assets/js/108.2c16a098.js"><link rel="prefetch" href="/assets/js/109.0fb05815.js"><link rel="prefetch" href="/assets/js/11.981c0761.js"><link rel="prefetch" href="/assets/js/110.64848bb3.js"><link rel="prefetch" href="/assets/js/112.f7c86b54.js"><link rel="prefetch" href="/assets/js/113.d89d004f.js"><link rel="prefetch" href="/assets/js/114.936c7721.js"><link rel="prefetch" href="/assets/js/115.773c5124.js"><link rel="prefetch" href="/assets/js/116.de48dba8.js"><link rel="prefetch" href="/assets/js/117.d74ca31c.js"><link rel="prefetch" href="/assets/js/118.5cc8e400.js"><link rel="prefetch" href="/assets/js/119.8a969200.js"><link rel="prefetch" href="/assets/js/12.aa78fb10.js"><link rel="prefetch" href="/assets/js/120.68a1e8ac.js"><link rel="prefetch" href="/assets/js/121.d25db968.js"><link rel="prefetch" href="/assets/js/122.bb81bef8.js"><link rel="prefetch" href="/assets/js/123.b04ac4a0.js"><link rel="prefetch" href="/assets/js/124.346709ad.js"><link rel="prefetch" href="/assets/js/125.1da4d201.js"><link rel="prefetch" href="/assets/js/126.1450acf6.js"><link rel="prefetch" href="/assets/js/127.57d247de.js"><link rel="prefetch" href="/assets/js/128.95832437.js"><link rel="prefetch" href="/assets/js/129.70fe4933.js"><link rel="prefetch" href="/assets/js/13.6f8fea9f.js"><link rel="prefetch" href="/assets/js/130.305c4ab0.js"><link rel="prefetch" href="/assets/js/131.121e8d6d.js"><link rel="prefetch" href="/assets/js/132.1083e965.js"><link rel="prefetch" href="/assets/js/133.385a3d5a.js"><link rel="prefetch" href="/assets/js/134.c63ad9ba.js"><link rel="prefetch" href="/assets/js/135.b077776d.js"><link rel="prefetch" href="/assets/js/136.08825927.js"><link rel="prefetch" href="/assets/js/137.2bfa6cad.js"><link rel="prefetch" href="/assets/js/138.cc4c0ac0.js"><link rel="prefetch" href="/assets/js/139.df36ad70.js"><link rel="prefetch" href="/assets/js/14.b7eecee6.js"><link rel="prefetch" href="/assets/js/140.8525c441.js"><link rel="prefetch" href="/assets/js/141.1b2f2db3.js"><link rel="prefetch" href="/assets/js/142.9d917ce9.js"><link rel="prefetch" href="/assets/js/143.43b52a98.js"><link rel="prefetch" href="/assets/js/144.2a1e517c.js"><link rel="prefetch" href="/assets/js/145.aba44319.js"><link rel="prefetch" href="/assets/js/146.4bf60f43.js"><link rel="prefetch" href="/assets/js/147.eb2af73b.js"><link rel="prefetch" href="/assets/js/148.7e6cf5f0.js"><link rel="prefetch" href="/assets/js/149.53632cda.js"><link rel="prefetch" href="/assets/js/15.a7fc0b27.js"><link rel="prefetch" href="/assets/js/150.ff88429e.js"><link rel="prefetch" href="/assets/js/151.f0d1dd16.js"><link rel="prefetch" href="/assets/js/152.8aea1d44.js"><link rel="prefetch" href="/assets/js/153.8c9a248c.js"><link rel="prefetch" href="/assets/js/154.c01cfd14.js"><link rel="prefetch" href="/assets/js/155.54595998.js"><link rel="prefetch" href="/assets/js/156.e0880a88.js"><link rel="prefetch" href="/assets/js/157.6d258d86.js"><link rel="prefetch" href="/assets/js/158.81fcb0bd.js"><link rel="prefetch" href="/assets/js/159.1a04c65d.js"><link rel="prefetch" href="/assets/js/16.8e01a7b2.js"><link rel="prefetch" href="/assets/js/160.894356a4.js"><link rel="prefetch" href="/assets/js/161.ef3f8367.js"><link rel="prefetch" href="/assets/js/162.ebf35c1b.js"><link rel="prefetch" href="/assets/js/163.5463b823.js"><link rel="prefetch" href="/assets/js/164.96798789.js"><link rel="prefetch" href="/assets/js/165.aaceda72.js"><link rel="prefetch" href="/assets/js/166.291f69d4.js"><link rel="prefetch" href="/assets/js/167.7ea52228.js"><link rel="prefetch" href="/assets/js/168.c651be6c.js"><link rel="prefetch" href="/assets/js/169.dc447396.js"><link rel="prefetch" href="/assets/js/17.a782667c.js"><link rel="prefetch" href="/assets/js/170.a4c7b9c1.js"><link rel="prefetch" href="/assets/js/171.74cbc58a.js"><link rel="prefetch" href="/assets/js/172.b69adc28.js"><link rel="prefetch" href="/assets/js/173.17a06c5c.js"><link rel="prefetch" href="/assets/js/174.55c047f4.js"><link rel="prefetch" href="/assets/js/175.193fe6b7.js"><link rel="prefetch" href="/assets/js/176.7b7edc01.js"><link rel="prefetch" href="/assets/js/177.a09fbfe0.js"><link rel="prefetch" href="/assets/js/178.f5c65baa.js"><link rel="prefetch" href="/assets/js/179.8ea89e7f.js"><link rel="prefetch" href="/assets/js/18.622c3362.js"><link rel="prefetch" href="/assets/js/180.b1bdff86.js"><link rel="prefetch" href="/assets/js/181.693b12c3.js"><link rel="prefetch" href="/assets/js/182.0b63a2c5.js"><link rel="prefetch" href="/assets/js/183.0586adcb.js"><link rel="prefetch" href="/assets/js/184.eb8b291a.js"><link rel="prefetch" href="/assets/js/185.ee9899f0.js"><link rel="prefetch" href="/assets/js/186.476a49ee.js"><link rel="prefetch" href="/assets/js/187.874be25d.js"><link rel="prefetch" href="/assets/js/188.205e89ec.js"><link rel="prefetch" href="/assets/js/189.7874b139.js"><link rel="prefetch" href="/assets/js/19.1a0a0937.js"><link rel="prefetch" href="/assets/js/190.22f3ca30.js"><link rel="prefetch" href="/assets/js/191.cbb208b0.js"><link rel="prefetch" href="/assets/js/192.9b536d24.js"><link rel="prefetch" href="/assets/js/193.5ab460ba.js"><link rel="prefetch" href="/assets/js/194.94d79fbe.js"><link rel="prefetch" href="/assets/js/195.788c7e50.js"><link rel="prefetch" href="/assets/js/196.a07dedd3.js"><link rel="prefetch" href="/assets/js/197.86eef775.js"><link rel="prefetch" href="/assets/js/198.e2b46901.js"><link rel="prefetch" href="/assets/js/199.bbae699f.js"><link rel="prefetch" href="/assets/js/20.71f246ab.js"><link rel="prefetch" href="/assets/js/200.6c43fe16.js"><link rel="prefetch" href="/assets/js/201.8825bd23.js"><link rel="prefetch" href="/assets/js/202.717f5881.js"><link rel="prefetch" href="/assets/js/203.e3597f20.js"><link rel="prefetch" href="/assets/js/204.38d9f737.js"><link rel="prefetch" href="/assets/js/205.b8d3b9be.js"><link rel="prefetch" href="/assets/js/206.d8c92711.js"><link rel="prefetch" href="/assets/js/21.53bd3331.js"><link rel="prefetch" href="/assets/js/22.695a300f.js"><link rel="prefetch" href="/assets/js/23.4a154ffd.js"><link rel="prefetch" href="/assets/js/24.cf563eea.js"><link rel="prefetch" href="/assets/js/25.e74fcb88.js"><link rel="prefetch" href="/assets/js/26.5fe05758.js"><link rel="prefetch" href="/assets/js/27.00caa9a9.js"><link rel="prefetch" href="/assets/js/28.9ecfac46.js"><link rel="prefetch" href="/assets/js/29.5f4a395d.js"><link rel="prefetch" href="/assets/js/3.38c831f5.js"><link rel="prefetch" href="/assets/js/30.6b2a3542.js"><link rel="prefetch" href="/assets/js/31.8673009d.js"><link rel="prefetch" href="/assets/js/32.83b96e0d.js"><link rel="prefetch" href="/assets/js/33.81d22e30.js"><link rel="prefetch" href="/assets/js/34.11403c0c.js"><link rel="prefetch" href="/assets/js/35.8f344415.js"><link rel="prefetch" href="/assets/js/36.11c2d57b.js"><link rel="prefetch" href="/assets/js/37.7ac47cfc.js"><link rel="prefetch" href="/assets/js/38.65531ab1.js"><link rel="prefetch" href="/assets/js/39.149baca2.js"><link rel="prefetch" href="/assets/js/4.21425a08.js"><link rel="prefetch" href="/assets/js/40.376638eb.js"><link rel="prefetch" href="/assets/js/41.21128237.js"><link rel="prefetch" href="/assets/js/42.d2e7c273.js"><link rel="prefetch" href="/assets/js/43.1f318964.js"><link rel="prefetch" href="/assets/js/44.980cbf7e.js"><link rel="prefetch" href="/assets/js/45.b5f1fd84.js"><link rel="prefetch" href="/assets/js/46.dd91c18f.js"><link rel="prefetch" href="/assets/js/47.7cc124c4.js"><link rel="prefetch" href="/assets/js/48.0c4e02e9.js"><link rel="prefetch" href="/assets/js/49.e56486c0.js"><link rel="prefetch" href="/assets/js/5.2655f233.js"><link rel="prefetch" href="/assets/js/50.4591a4bf.js"><link rel="prefetch" href="/assets/js/51.dbd16585.js"><link rel="prefetch" href="/assets/js/52.c13dec00.js"><link rel="prefetch" href="/assets/js/53.b76cbf62.js"><link rel="prefetch" href="/assets/js/54.8fab2868.js"><link rel="prefetch" href="/assets/js/55.6a5c85dd.js"><link rel="prefetch" href="/assets/js/56.570da52f.js"><link rel="prefetch" href="/assets/js/57.bd5d0d84.js"><link rel="prefetch" href="/assets/js/58.d309d049.js"><link rel="prefetch" href="/assets/js/59.561988a0.js"><link rel="prefetch" href="/assets/js/6.3aded8a5.js"><link rel="prefetch" href="/assets/js/60.739ba9b6.js"><link rel="prefetch" href="/assets/js/61.92ef0af3.js"><link rel="prefetch" href="/assets/js/62.dc5137e0.js"><link rel="prefetch" href="/assets/js/63.c796a4cb.js"><link rel="prefetch" href="/assets/js/64.99d443b2.js"><link rel="prefetch" href="/assets/js/65.98b72c72.js"><link rel="prefetch" href="/assets/js/66.4d785267.js"><link rel="prefetch" href="/assets/js/67.19a09eb4.js"><link rel="prefetch" href="/assets/js/68.6e5c0979.js"><link rel="prefetch" href="/assets/js/69.e9aaba26.js"><link rel="prefetch" href="/assets/js/7.d037a6ce.js"><link rel="prefetch" href="/assets/js/70.9a81c963.js"><link rel="prefetch" href="/assets/js/71.fa6e75cc.js"><link rel="prefetch" href="/assets/js/72.92450611.js"><link rel="prefetch" href="/assets/js/73.5a6c977b.js"><link rel="prefetch" href="/assets/js/74.8ba8496a.js"><link rel="prefetch" href="/assets/js/75.09c52575.js"><link rel="prefetch" href="/assets/js/76.7d2e730f.js"><link rel="prefetch" href="/assets/js/77.7a9705a2.js"><link rel="prefetch" href="/assets/js/78.01dc1611.js"><link rel="prefetch" href="/assets/js/79.3766f2a1.js"><link rel="prefetch" href="/assets/js/8.9bac5ce4.js"><link rel="prefetch" href="/assets/js/80.1ca5a27c.js"><link rel="prefetch" href="/assets/js/81.ee18d39f.js"><link rel="prefetch" href="/assets/js/82.02b6c378.js"><link rel="prefetch" href="/assets/js/83.3d2b80ae.js"><link rel="prefetch" href="/assets/js/84.27509f50.js"><link rel="prefetch" href="/assets/js/85.755c96b6.js"><link rel="prefetch" href="/assets/js/86.9061fe84.js"><link rel="prefetch" href="/assets/js/87.c5efafa4.js"><link rel="prefetch" href="/assets/js/88.a5bb08d8.js"><link rel="prefetch" href="/assets/js/89.3d00fa6d.js"><link rel="prefetch" href="/assets/js/9.fcb65bbd.js"><link rel="prefetch" href="/assets/js/90.091648e8.js"><link rel="prefetch" href="/assets/js/91.828e5829.js"><link rel="prefetch" href="/assets/js/92.3ff519e0.js"><link rel="prefetch" href="/assets/js/93.af8cf700.js"><link rel="prefetch" href="/assets/js/94.c00842c6.js"><link rel="prefetch" href="/assets/js/95.f5d02320.js"><link rel="prefetch" href="/assets/js/96.ce6f94b3.js"><link rel="prefetch" href="/assets/js/97.a6559442.js"><link rel="prefetch" href="/assets/js/98.d37c6b38.js"><link rel="prefetch" href="/assets/js/99.52c5abe4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.158fcf67.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端积累</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/frontend/" class="nav-link">
  大前端
</a></div><div class="nav-item"><a href="/js设计模式/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  java
</a></div><div class="nav-item"><a href="/vue2/" class="nav-link">
  vue2
</a></div><div class="nav-item"><a href="/vue3/" class="nav-link">
  vue3
</a></div><div class="nav-item"><a href="/web/apply、call、bind的区别.html" class="nav-link">
  web
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/ts/chapter1/" class="nav-link">
  ts封装axios
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  interview
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">
  面试题
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/frontend/" class="nav-link">
  大前端
</a></div><div class="nav-item"><a href="/js设计模式/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  java
</a></div><div class="nav-item"><a href="/vue2/" class="nav-link">
  vue2
</a></div><div class="nav-item"><a href="/vue3/" class="nav-link">
  vue3
</a></div><div class="nav-item"><a href="/web/apply、call、bind的区别.html" class="nav-link">
  web
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/ts/chapter1/" class="nav-link">
  ts封装axios
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  interview
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">
  面试题
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" aria-current="page" class="sidebar-link">js设计模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#论工程师的设计能力" class="sidebar-link">论工程师的设计能力</a></li><li class="sidebar-sub-header"><a href="/js%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#_5大设计原则-23种设计模式" class="sidebar-link">5大设计原则, 23种设计模式</a></li></ul></li><li><a href="/js设计模式/01-面向对象.html" class="sidebar-link">01-面向对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/01-面向对象.html#demo" class="sidebar-link">demo</a></li><li class="sidebar-sub-header"><a href="/js设计模式/01-面向对象.html#三要素" class="sidebar-link">三要素</a></li><li class="sidebar-sub-header"><a href="/js设计模式/01-面向对象.html#应用场景-jquery-中使用面向对象" class="sidebar-link">应用场景-jQuery 中使用面向对象</a></li><li class="sidebar-sub-header"><a href="/js设计模式/01-面向对象.html#为何要用面向对象" class="sidebar-link">为何要用面向对象</a></li><li class="sidebar-sub-header"><a href="/js设计模式/01-面向对象.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/js设计模式/02-设计原则.html" class="sidebar-link">02-设计原则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/02-设计原则.html#何为-设计" class="sidebar-link">何为“设计”</a></li><li class="sidebar-sub-header"><a href="/js设计模式/02-设计原则.html#_5-大设计原则" class="sidebar-link">5 大设计原则</a></li><li class="sidebar-sub-header"><a href="/js设计模式/02-设计原则.html#举例说明" class="sidebar-link">举例说明</a></li><li class="sidebar-sub-header"><a href="/js设计模式/02-设计原则.html#简介-23-种设计模式" class="sidebar-link">简介 23 种设计模式</a></li><li class="sidebar-sub-header"><a href="/js设计模式/02-设计原则.html#如何学习设计模式" class="sidebar-link">如何学习设计模式</a></li></ul></li><li><a href="/js设计模式/03-工厂模式.html" class="sidebar-link">03-工厂模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/03-工厂模式.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/js设计模式/03-工厂模式.html#演示" class="sidebar-link">演示</a></li><li class="sidebar-sub-header"><a href="/js设计模式/03-工厂模式.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/js设计模式/03-工厂模式.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js设计模式/04-单例模式.html" class="sidebar-link">04-单例模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/04-单例模式.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/js设计模式/04-单例模式.html#演示" class="sidebar-link">演示</a></li><li class="sidebar-sub-header"><a href="/js设计模式/04-单例模式.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/js设计模式/04-单例模式.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js设计模式/05-适配器模式.html" class="sidebar-link">05-适配器模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/05-适配器模式.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/js设计模式/05-适配器模式.html#演示" class="sidebar-link">演示</a></li><li class="sidebar-sub-header"><a href="/js设计模式/05-适配器模式.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/js设计模式/05-适配器模式.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js设计模式/06-装饰器模式.html" class="sidebar-link">06-装饰器模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/06-装饰器模式.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/js设计模式/06-装饰器模式.html#演示" class="sidebar-link">演示</a></li><li class="sidebar-sub-header"><a href="/js设计模式/06-装饰器模式.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/js设计模式/06-装饰器模式.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js设计模式/07-代理模式.html" class="sidebar-link">07-代理模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/07-代理模式.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/js设计模式/07-代理模式.html#演示" class="sidebar-link">演示</a></li><li class="sidebar-sub-header"><a href="/js设计模式/07-代理模式.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/js设计模式/07-代理模式.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js设计模式/08-外观模式.html" class="sidebar-link">08-外观模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/08-外观模式.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/js设计模式/08-外观模式.html#演示" class="sidebar-link">演示</a></li><li class="sidebar-sub-header"><a href="/js设计模式/08-外观模式.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/js设计模式/08-外观模式.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js设计模式/10-观察者模式.html" class="active sidebar-link">10-观察者模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js设计模式/10-观察者模式.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/js设计模式/10-观察者模式.html#演示" class="sidebar-link">演示</a></li><li class="sidebar-sub-header"><a href="/js设计模式/10-观察者模式.html#场景" class="sidebar-link">场景</a></li><li class="sidebar-sub-header"><a href="/js设计模式/10-观察者模式.html#总结" class="sidebar-link">总结</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="观察者模式-前端用的最多"><a href="#观察者模式-前端用的最多" class="header-anchor">#</a> 观察者模式(前端用的最多)</h1> <p>观察者模式是前端最常用、最重要的设计模式，如果让你只掌握一种设计模式，那肯定就是观察者模式！！！</p> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>当对象间存在一对多关系时, 则使用观察者模式（Observer Pattern）。比如，当一个对象被修改时，则会自动通知它的依赖对象。一对多的关系。</p> <h2 id="演示"><a href="#演示" class="header-anchor">#</a> 演示</h2> <p>传统的 UML 类图</p> <p><a href="https://imgtu.com/i/6rucef" target="_blank" rel="noopener noreferrer"><img src="https://s3.ax1x.com/2021/03/15/6rucef.png" alt="6rucef.png"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>简化之后的 UML 类图</p> <p><a href="https://imgtu.com/i/6rusyt" target="_blank" rel="noopener noreferrer"><img src="https://s3.ax1x.com/2021/03/15/6rusyt.png" alt="6rusyt.png"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>例如你在星巴克点了咖啡，此时你并不需要在吧台坐等，你只需要回到位子上玩手机，等咖啡好了服务员会叫你。不光叫你，其他人的咖啡好了，服务员也会叫他们来取。</p> <p>还有，网页事件就是最常用的观察者模式</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>btn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 先把事件写好, 点击了就会触发</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>另外，JS 异步，只要用到 callback 函数，都是观察者模式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码演示</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 主题，接收状态变化，触发每个观察者</span>
<span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
  <span class="token punctuation">}</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAllObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">attach</span><span class="token punctuation">(</span><span class="token parameter">observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">notifyAllObservers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 观察者，等待被触发</span>
<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> subject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">this</span><span class="token punctuation">.</span>subject <span class="token operator">=</span> subject
    <span class="token keyword">this</span><span class="token punctuation">.</span>subject<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> update, state: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>subject<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试代码</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> o1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'o1'</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">let</span> o2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'o2'</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">let</span> o3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'o3'</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>

s<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="场景"><a href="#场景" class="header-anchor">#</a> 场景</h2> <p>观察者模式在 JS 中的应用场景非常多，绝不仅限于以下列举的场景。本节列举了很多示例，旨在从多角度理解观察者模式的应用场景，以及体会观察者模式在 JS 中的应用之广泛。</p> <p><strong>增加一个场景：vue 的 watcher</strong></p> <h3 id="网页事件"><a href="#网页事件" class="header-anchor">#</a> 网页事件</h3> <p>一开始就说过了，不再赘述</p> <h3 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h3> <p>一开始说到异步有 callback 的都是观察者模式，而 Promise 作为异步的解决方案，也避免不了要使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'图片加载失败'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> src
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>

<span class="token keyword">var</span> src <span class="token operator">=</span> <span class="token string">'https://www.imooc.com/static/img/index/logo_new.png'</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">loadImg</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span>
result
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
    <span class="token keyword">return</span> img
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>resolve</code>和<code>reject</code>就相当于之前的<code>setState</code>，状态改变，其实这也是 Promise 的真实状态变化：pending -&gt; fulfilled 或者 pending -&gt; rejected 。两个<code>then</code>就是观察者，状态变化就会触发观察者<code>update</code> 。</p> <p><strong>预告：下面讲到状态模式的时候，会演示如何自己实现一个 Promise</strong></p> <h3 id="jquery-callbacks"><a href="#jquery-callbacks" class="header-anchor">#</a> jQuery callbacks</h3> <p>jQuery callbacks 是 jQuery 的内部底层功能，服务于对外的 API 如 ajax deferred 等。jQuery 这么通用的 lib 都有必要维护一个通用的观察者功能，可见观察者模式在 JS 中的应用之广泛</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> callbacks <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">Callbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 注意大小写</span>
callbacks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1'</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
callbacks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn2'</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
callbacks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn3'</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
callbacks<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'gogogo'</span><span class="token punctuation">)</span>
callbacks<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">'fire'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="nodejs-自定义事件"><a href="#nodejs-自定义事件" class="header-anchor">#</a> nodejs 自定义事件</h3> <p>简单 demo</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter

<span class="token keyword">const</span> emitter1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
emitter1<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'some'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 监听 some 事件</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'some event is occured 1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
emitter1<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'some'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 监听 some 事件</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'some event is occured 2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 触发 some 事件</span>
emitter1<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'some'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>以上代码中，先引入 nodejs 提供的<code>EventEmitter</code>构造函数，然后初始化一个实例<code>emitter1</code>。实例通过<code>on</code>可监听事件，<code>emit</code>可以触发事件，事件名称可以自定义，如<code>some</code>。</p> <p>自定义事件触发的时候还可传递参数，例如</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter
<span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'sbowName'</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'event occured '</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'sbowName'</span><span class="token punctuation">,</span> <span class="token string">'zhangsan'</span><span class="token punctuation">)</span> <span class="token comment">// emit 时候可以传递参数过去</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上文说到<code>EventEmitter</code>实例有<code>on</code>和<code>emit</code>接口，其实自定义 class 的实例也可以有，只不过需要继承<code>EventEmitter</code>。使用 ES6 的继承语法很容易实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter

<span class="token comment">// 任何构造函数都可以继承 EventEmitter 的方法 on emit</span>
<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> simon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token string">'simon'</span><span class="token punctuation">)</span>
simon<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'bark'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">' barked'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  simon<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'bark'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>和 jQuery callbacks 一样，自定义事件也是 nodejs 中底层、通用的功能，很多其他功能要继承<code>EventEmitter</code>以实现自定义事件功能，下文会讲到，也能看出观察者模式在 nodejs 中应用的广泛。</p> <h3 id="nodejs-stream"><a href="#nodejs-stream" class="header-anchor">#</a> nodejs stream</h3> <p>stream 是 nodejs 的基础模块，就是把大数据（一次性读取内存放不开）的操作当做一个流，来一点一点的读取，直到读取完毕。</p> <p>例如一个大文件，几百万行（一般是日志文件），想要得知它的字符长度，就需要用到 stream 。既然是一点一点的读取，那么每次读取一点就得知道读取的是什么，读取完毕也得得到通知，这就需要观察者模式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Stream 用到了自定义事件</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./data/file1.txt'</span><span class="token punctuation">)</span> <span class="token comment">// 读取文件的 Stream</span>

<span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token number">0</span>
readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  length <span class="token operator">+=</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
<span class="token punctuation">}</span><span class="token punctuation">)</span>
readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>nodejs 还专门指定了 readline ，跟上述的模式一样，只不过是一行一行读取文件，例如要知道上述文件一共有多少行，可以使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// readline 用到了自定义事件</span>
<span class="token keyword">var</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  input<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./data/file1.txt'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> lineNum <span class="token operator">=</span> <span class="token number">0</span>
rl<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  lineNum<span class="token operator">++</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
rl<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lineNum'</span><span class="token punctuation">,</span> lineNum<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>最后一个示例，当 nodejs 接收 post 请求时，也需要一点一点的接收</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">serverCallback</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取请求的方法</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get 请求不处理'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'post'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 接收 post 请求的内容</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">''</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// “一点一点”接收内容</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'chunk'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      data <span class="token operator">+=</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 接收完毕，将内容输出</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'Content-type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>serverCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">)</span> <span class="token comment">// 注意端口别和其他 server 的冲突</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听 8081 端口……'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>使用 curl 模拟一下即可</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> -H <span class="token string">&quot;Content-Type:application/json&quot;</span> -X POST -d <span class="token string">'{&quot;user&quot;: &quot;admin&quot;, &quot;passwd&quot;:&quot;12345678&quot;}'</span> http://127.0.0.1:8081/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="nodejs-多进程通讯"><a href="#nodejs-多进程通讯" class="header-anchor">#</a> nodejs 多进程通讯</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// parent.js</span>
<span class="token keyword">var</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">'./sub.js'</span><span class="token punctuation">)</span>
n<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PARENT got message: '</span> <span class="token operator">+</span> m<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
n<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hello<span class="token operator">:</span> <span class="token string">'workd'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// sub.js</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CHILD got message: '</span> <span class="token operator">+</span> m<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>同理于浏览器端的 webworker</strong> ，不再演示。</p> <h3 id="组件生命周期"><a href="#组件生命周期" class="header-anchor">#</a> 组件生命周期</h3> <p><a href="https://imgtu.com/i/6rKEfH" target="_blank" rel="noopener noreferrer"><img src="https://s3.ax1x.com/2021/03/15/6rKEfH.png" alt="6rKEfH.png"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>vue React 使用组件化，每个组件实例都有固定的生命周期，生命周期的意思就是在实例运行的某个特定的节点，执行你要做的操作，例如<code>created</code>生命周期，打印一句话：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// `this` 指向 vm 实例</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a is: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这些生命周期的函数，其实也都是观察者，当组件实例运行到某个阶段时，就会触发这个观察者。这是 vue 源码中的某个片段</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">callHook</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> hook</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> handlers <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">[</span>hook<span class="token punctuation">]</span> <span class="token comment">// 获取生命周期的所有函数</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>handlers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> handlers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      handlers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 遍历，挨个触发</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm
<span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span> <span class="token comment">// 触发 beforeCreate 生命周期</span>
<span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
<span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span> <span class="token comment">// 触发 created 生命周期</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="vue-响应式的实现"><a href="#vue-响应式的实现" class="header-anchor">#</a> vue 响应式的实现</h3> <p>vue 响应式大家都清楚，data 变化立即触发 view 的变化</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{price}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/vue/2.5.9/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    el<span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      price<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'zhangsan'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 修改 vm.price ，页面内容会立刻修改</span>
  vm<span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token number">200</span>
  vm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'imooc'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>网上一搜 vue 响应式的原理特别复杂，如下图：</p> <p><a href="https://imgtu.com/i/6rKAte" target="_blank" rel="noopener noreferrer"><img src="https://s3.ax1x.com/2021/03/15/6rKAte.png" alt="6rKAte.png"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>其实单就了解原理，就没必要看这么多细节，你也没必要了解这么多细节，抛开细节就简单多了。其实只有三点：</p> <ul><li>如何监听<code>vm.price</code>的变化？</li> <li>如何更新 view ，让它作为观察者</li> <li>两者形成观察者模式</li></ul> <p>先说第一个问题，借用<code>Object.defineProperty</code>就可以实现这种需求</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'zhangsan'</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> newVal
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 可以监听到</span>
obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'lisi'</span> <span class="token comment">// 可以监听到</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>第二个问题，更新 view 内部逻辑比较复杂，但是我们这里没必要细究，只知道它就是重新获取了 data 中的数据，重新渲染 view ，就可以了</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>最后，两者形成观察者模式，这里的细节也非常复杂，毕竟 vue 是全球都在用的 MVVM 框架，但是没必要细究，从下面的代码中可以窥探出，它就是用了观察者模式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>
  vm<span class="token punctuation">,</span>
  updateComponent<span class="token punctuation">,</span>
  noop<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function-variable function">before</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeUpdate'</span><span class="token punctuation">)</span> <span class="token comment">// 触发 beforeUpdate 生命周期</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span> <span class="token comment">/* isRenderWatcher */</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="一对多的关系"><a href="#一对多的关系" class="header-anchor">#</a> 一对多的关系</h3> <p>观察者模式表示的是<strong>一对多关系</strong>。上述例子中，有些明显是一对多关系，有些演示的是一对一的关系 —— 但是，他们也都支持一对多，只不过暂时用一对一而已。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后编辑时间:</span> <span class="time">3/16/2021, 7:31:15 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js设计模式/08-外观模式.html" class="prev">
        08-外观模式
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a861c563.js" defer></script><script src="/assets/js/2.607a1425.js" defer></script><script src="/assets/js/111.85d639f5.js" defer></script>
  </body>
</html>
